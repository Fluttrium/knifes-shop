# –°–∏—Å—Ç–µ–º–∞ –∑–∞–∫–∞–∑–æ–≤ –∏ –ø–ª–∞—Ç–µ–∂–µ–π

## –û–±–∑–æ—Ä

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∑–∞–∫–∞–∑–æ–≤ –∏ –ø–ª–∞—Ç–µ–∂–µ–π –¥–ª—è –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω–∞ –Ω–æ–∂–µ–π —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –ÆKassa.

## –ß—Ç–æ –±—ã–ª–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

1. **–ú–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞** - —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏:
   - `OrderModule` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏
   - `PaymentModule` - –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –ø–ª–∞—Ç–µ–∂–µ–π
   - `CartModule` - –∫–æ—Ä–∑–∏–Ω–∞ (—É–∂–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª)

2. **–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –ø–ª–∞—Ç–µ–∂–µ–π** - –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π —á–µ—Ä–µ–∑ –ÆKassa

### üì¶ –°–∏—Å—Ç–µ–º–∞ –∑–∞–∫–∞–∑–æ–≤

#### Backend (NestJS)

**–ú–æ–¥—É–ª–∏:**
- `apps/api/src/order/` - –æ—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å –∑–∞–∫–∞–∑–æ–≤
- `apps/api/src/payment/` - –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –ø–ª–∞—Ç–µ–∂–µ–π

**–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**

1. **OrderService** - –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∑–∞–∫–∞–∑–æ–≤:
   - –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Ç–æ–≤–∞—Ä–æ–≤
   - –†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞–º–∏

2. **OrderController** - API –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
   - `POST /orders` - —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞
   - `GET /orders` - —Å–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - `GET /orders/:id` - –¥–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞
   - `PATCH /orders/:id/cancel` - –æ—Ç–º–µ–Ω–∞ –∑–∞–∫–∞–∑–∞

3. **OrderAdminController** - API –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤:
   - `GET /admin/orders` - –≤—Å–µ –∑–∞–∫–∞–∑—ã —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π
   - `GET /admin/orders/statistics` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
   - `PATCH /admin/orders/:id/status` - –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞

4. **AddressService** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–∞–º–∏:
   - CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –∞–¥—Ä–µ—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - –ê–¥—Ä–µ—Å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –∑–∞–∫–∞–∑–∞—Ö

#### Frontend (Next.js)

**–°—Ç—Ä–∞–Ω–∏—Ü—ã:**
- `/checkout` - –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞
- `/orders` - —Å–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `/dashboard/orders` - –∞–¥–º–∏–Ω–∫–∞ –∑–∞–∫–∞–∑–æ–≤ (—É–∂–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª–∞)

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
- –í—ã–±–æ—Ä –∞–¥—Ä–µ—Å–∞ –¥–æ—Å—Ç–∞–≤–∫–∏
- –ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∑–∞–∫–∞–∑–µ
- –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –∏ –ø–ª–∞—Ç–µ–∂–∞
- –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –æ–ø–ª–∞—Ç—É

### üí≥ –°–∏—Å—Ç–µ–º–∞ –ø–ª–∞—Ç–µ–∂–µ–π

#### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ÆKassa

**PaymentService:**
- –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–µ–π –≤ –ÆKassa
- –û–±—Ä–∞–±–æ—Ç–∫–∞ webhook'–æ–≤
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –∑–∞–∫–∞–∑–æ–≤
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∫–ª–∞–¥—Å–∫–∏–º–∏ –æ—Å—Ç–∞—Ç–∫–∞–º–∏

**API endpoints:**
- `POST /payments` - —Å–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞
- `GET /payments/:id/status` - —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞
- `POST /webhooks/payment/yookassa` - webhook –æ—Ç –ÆKassa

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —á–µ–∫–∞ –¥–ª—è –Ω–∞–ª–æ–≥–æ–≤–æ–π
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å—Ç–∞—Ç—É—Å–æ–≤ –ø–ª–∞—Ç–µ–∂–µ–π
- –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ webhook'–æ–≤

### üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

**–û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥–µ–ª–∏:**
- `Order` - –∑–∞–∫–∞–∑—ã
- `OrderItem` - —Ç–æ–≤–∞—Ä—ã –≤ –∑–∞–∫–∞–∑–µ
- `Payment` - –ø–ª–∞—Ç–µ–∂–∏
- `Address` - –∞–¥—Ä–µ—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `Parcel` - –ø–æ—Å—ã–ª–∫–∏ (–¥–ª—è –∞–¥–º–∏–Ω–∫–∏)

**–°—Ç–∞—Ç—É—Å—ã –∑–∞–∫–∞–∑–æ–≤:**
- `pending` - –æ–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã
- `confirmed` - –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω
- `processing` - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è
- `shipped` - –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω
- `delivered` - –¥–æ—Å—Ç–∞–≤–ª–µ–Ω
- `cancelled` - –æ—Ç–º–µ–Ω–µ–Ω
- `refunded` - –≤–æ–∑–≤—Ä–∞—â–µ–Ω

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** - JWT —Ç–æ–∫–µ–Ω—ã
2. **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** - —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (user/admin)
3. **–í–∞–ª–∏–¥–∞—Ü–∏—è** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö
4. **Webhook –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–µ–π (–∑–∞–≥–æ—Ç–æ–≤–∫–∞)

## –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç—ã

### 1. –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–±–∞–≤–ª—è–µ—Ç —Ç–æ–≤–∞—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω—É
2. –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ `/checkout`
3. –í—ã–±–∏—Ä–∞–µ—Ç –∞–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏
4. –ù–∞–∂–∏–º–∞–µ—Ç "–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑"
5. –°–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–∫–∞–∑ –≤ —Å—Ç–∞—Ç—É—Å–µ `pending`
6. –°–æ–∑–¥–∞–µ—Ç—Å—è –ø–ª–∞—Ç–µ–∂ –≤ –ÆKassa
7. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ –æ–ø–ª–∞—Ç—É

### 2. –û–ø–ª–∞—Ç–∞
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç –∑–∞–∫–∞–∑ —á–µ—Ä–µ–∑ –ÆKassa
2. –ÆKassa –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç webhook –Ω–∞ `/webhooks/payment/yookassa`
3. –°–∏—Å—Ç–µ–º–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ –Ω–∞ `confirmed`
4. –£–º–µ–Ω—å—à–∞—é—Ç—Å—è –æ—Å—Ç–∞—Ç–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Å–∫–ª–∞–¥–µ
5. –ö–æ—Ä–∑–∏–Ω–∞ –æ—á–∏—â–∞–µ—Ç—Å—è

### 3. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ
1. –ê–¥–º–∏–Ω –≤–∏–¥–∏—Ç –≤—Å–µ –∑–∞–∫–∞–∑—ã –≤ `/dashboard/orders`
2. –ú–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å —Å—Ç–∞—Ç—É—Å—ã –∑–∞–∫–∞–∑–æ–≤
3. –£–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ—Å—ã–ª–∫–∞–º–∏ –∏ –¥–æ—Å—Ç–∞–≤–∫–æ–π
4. –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```env
# –ÆKassa
YOO_KASSA_SHOP_ID=your_shop_id
YOO_KASSA_SECRET_KEY=your_secret_key
YOO_KASSA_API_URL=https://api.yookassa.ru/v3

# Frontend URL –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã
FRONTEND_URL=http://localhost:3000
```

## API Endpoints

### –ó–∞–∫–∞–∑—ã (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏)
- `POST /orders` - —Å–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑
- `GET /orders` - —Å–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤
- `GET /orders/:id` - –¥–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞
- `GET /orders/number/:number` - –∑–∞–∫–∞–∑ –ø–æ –Ω–æ–º–µ—Ä—É
- `PATCH /orders/:id/cancel` - –æ—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑

### –ê–¥—Ä–µ—Å–∞
- `GET /orders/addresses` - —Å–ø–∏—Å–æ–∫ –∞–¥—Ä–µ—Å–æ–≤
- `POST /orders/addresses` - —Å–æ–∑–¥–∞—Ç—å –∞–¥—Ä–µ—Å
- `PATCH /orders/addresses/:id` - –æ–±–Ω–æ–≤–∏—Ç—å –∞–¥—Ä–µ—Å
- `DELETE /orders/addresses/:id` - —É–¥–∞–ª–∏—Ç—å –∞–¥—Ä–µ—Å
- `PATCH /orders/addresses/:id/default` - —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

### –ó–∞–∫–∞–∑—ã (–∞–¥–º–∏–Ω)
- `GET /admin/orders` - –≤—Å–µ –∑–∞–∫–∞–∑—ã
- `GET /admin/orders/statistics` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- `GET /admin/orders/:id` - –¥–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞
- `PATCH /admin/orders/:id/status` - –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å

### –ü–ª–∞—Ç–µ–∂–∏
- `POST /payments` - —Å–æ–∑–¥–∞—Ç—å –ø–ª–∞—Ç–µ–∂
- `GET /payments/:id/status` - —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞
- `POST /webhooks/payment/yookassa` - webhook –æ—Ç –ÆKassa

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã –¥–æ—Å—Ç–∞–≤–∫–∏** - —Ä–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –¥–æ—Å—Ç–∞–≤–∫–∏
2. **–°–∏—Å—Ç–µ–º–∞ –∫—É–ø–æ–Ω–æ–≤** - —Å–∫–∏–¥–∫–∏ –∏ –ø—Ä–æ–º–æ–∫–æ–¥—ã
3. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** - email/SMS –æ —Å—Ç–∞—Ç—É—Å–µ –∑–∞–∫–∞–∑–∞
4. **–í–æ–∑–≤—Ä–∞—Ç—ã** - —Å–∏—Å—Ç–µ–º–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ —Ç–æ–≤–∞—Ä–æ–≤
5. **–û—Ç–∑—ã–≤—ã** - –æ—Ç–∑—ã–≤—ã –æ —Ç–æ–≤–∞—Ä–∞—Ö –ø–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏
6. **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞** - –¥–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–¥–∞–∂

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã:

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ API: `cd apps/api && npm run start:dev`
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ Frontend: `cd apps/web && npm run dev`
3. –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –∞–∫–∫–∞—É–Ω—Ç
4. –î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω—É
5. –ü—Ä–æ–π–¥–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞
6. –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–µ–π –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç—ã –ÆKassa

## –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ÆKassa](https://yookassa.ru/developers)
- [NestJS –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://docs.nestjs.com/)
- [Prisma –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://www.prisma.io/docs/) 