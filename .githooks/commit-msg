#!/bin/bash

get_russian_quote() {
    # ÐŸÑ€Ð¾Ð±ÑƒÐµÐ¼ FavQs (Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚!)
    response=$(curl -s "https://favqs.com/api/qotd")

    if [ ! -z "$response" ] && [[ "$response" == *"body"* ]]; then
        # ÐŸÑ€Ð¾ÑÑ‚Ð¾Ð¹ Ð¿Ð°Ñ€ÑÐ¸Ð½Ð³ Ð±ÐµÐ· jq
        text=$(echo "$response" | sed -n 's/.*"body":"\([^"]*\)".*/\1/p')
        author=$(echo "$response" | sed -n 's/.*"author":"\([^"]*\)".*/\1/p')

        if [ ! -z "$text" ] && [ ! -z "$author" ]; then
            # ÐŸÐµÑ€ÐµÐ²Ð¾Ð´Ð¸Ð¼ Ñ‡ÐµÑ€ÐµÐ· Google Translate
            encoded_text=$(echo "$text" | sed 's/ /%20/g' | sed 's/,/%2C/g' | sed 's/\./%2E/g')
            translated=$(curl -s "https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=ru&dt=t&q=$encoded_text" | sed 's/\[\[\["//' | sed 's/",.*//')

            if [ ! -z "$translated" ] && [ "$translated" != "null" ]; then
                echo "$translated - $author"
                return
            else
                echo "$text - $author"
                return
            fi
        fi
    fi

    # Fallback
    russian_quotes=(
        "Â«ÐšÐ¾Ð´ - ÑÑ‚Ð¾ Ð¿Ð¾ÑÐ·Ð¸Ñ Ð² Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¸Â» - Ð”Ð¾Ð½Ð°Ð»ÑŒÐ´ ÐšÐ½ÑƒÑ‚"
        "Â«ÐŸÑ€Ð¾ÑÑ‚Ð¾Ñ‚Ð° - Ð²Ñ‹ÑÑˆÐ°Ñ Ð¸Ð·Ð¾Ñ‰Ñ€Ñ‘Ð½Ð½Ð¾ÑÑ‚ÑŒÂ» - Ð›ÐµÐ¾Ð½Ð°Ñ€Ð´Ð¾ Ð´Ð° Ð’Ð¸Ð½Ñ‡Ð¸"
        "Â«ÐŸÑ€Ð¸ÑˆÑ‘Ð», ÑƒÐ²Ð¸Ð´ÐµÐ», Ð·Ð°ÐºÐ¾Ð¼Ð¼Ð¸Ñ‚Ð¸Ð»Â» - Ð“Ð°Ð¹ Ð®Ð»Ð¸Ð¹ Ð¦ÐµÐ·Ð°Ñ€ÑŒ"
        "Â«Ð Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ð½Ð° Ð¼Ð¾ÐµÐ¹ Ð¼Ð°ÑˆÐ¸Ð½ÐµÂ» - ÐšÐ°Ð¶Ð´Ñ‹Ð¹ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº"
        "Â«Debugging - ÑÑ‚Ð¾ ÐºÐ°Ðº Ð±Ñ‹Ñ‚ÑŒ Ð´ÐµÑ‚ÐµÐºÑ‚Ð¸Ð²Ð¾Ð¼ Ð² ÐºÑ€Ð¸Ð¼Ð¸Ð½Ð°Ð»ÑŒÐ½Ð¾Ð¹ Ð´Ñ€Ð°Ð¼ÐµÂ» - Ð¤Ð¸Ð»Ð¸Ð¿ Ð‘Ð°Ñ‚Ñ†"
    )
    echo ${russian_quotes[$RANDOM % ${#russian_quotes[@]}]}
}

commit_message=$(cat "$1")
quote=$(get_russian_quote)

echo "$commit_message" > "$1"
echo "" >> "$1"
echo "ðŸ’¡ $quote" >> "$1"