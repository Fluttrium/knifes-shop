#!/bin/bash

get_russian_quote() {
    # Пробуем FavQs (работает!)
    response=$(curl -s "https://favqs.com/api/qotd")

    if [ ! -z "$response" ] && [[ "$response" == *"body"* ]]; then
        # Простой парсинг без jq
        text=$(echo "$response" | sed -n 's/.*"body":"\([^"]*\)".*/\1/p')
        author=$(echo "$response" | sed -n 's/.*"author":"\([^"]*\)".*/\1/p')

        if [ ! -z "$text" ] && [ ! -z "$author" ]; then
            # Переводим через Google Translate
            encoded_text=$(echo "$text" | sed 's/ /%20/g' | sed 's/,/%2C/g' | sed 's/\./%2E/g')
            translated=$(curl -s "https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=ru&dt=t&q=$encoded_text" | sed 's/\[\[\["//' | sed 's/",.*//')

            if [ ! -z "$translated" ] && [ "$translated" != "null" ]; then
                echo "$translated - $author"
                return
            else
                echo "$text - $author"
                return
            fi
        fi
    fi

    # Fallback
    russian_quotes=(
        "«Код - это поэзия в действии» - Дональд Кнут"
        "«Простота - высшая изощрённость» - Леонардо да Винчи"
        "«Пришёл, увидел, закоммитил» - Гай Юлий Цезарь"
        "«Работает на моей машине» - Каждый разработчик"
        "«Debugging - это как быть детективом в криминальной драме» - Филип Батц"
    )
    echo ${russian_quotes[$RANDOM % ${#russian_quotes[@]}]}
}

commit_message=$(cat "$1")
quote=$(get_russian_quote)

echo "$commit_message" > "$1"
echo "" >> "$1"
echo "💡 $quote" >> "$1"